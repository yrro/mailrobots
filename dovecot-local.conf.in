verbose_proctitle = yes

# These are overridden by individual account lookups
mail_uid = mailstorage
mail_gid = mailstorage

# These aren't strictly necessary, since our password database shouldn't be
# returning uid/gid information
first_valid_uid = @mailstorage_uid@
last_valid_uid = @mailstorage_uid@
first_valid_gid = @mailstorage_gid@
last_valid_gid = @mailstorage_gid@

ssl = required
ssl_cert = </etc/dovecot/ssl/imap-LE-cert+chain.pem
ssl_key = </etc/dovecot/ssl/imap-LE-key.pem
ssl_cipher_list = HIGH:!DSS:!aNULL

passdb {
    driver = passwd-file
    args = scheme=crypt /srv/mail/passwd
}

userdb {
    driver = passwd-file
    args = /srv/mail/passwd
}

lmtp_save_to_detail_mailbox = yes

namespace inbox {
    mailbox Spam {
        auto = subscribe
        special_use = \Junk
    }
}

plugin {
    recipient_delimiter = +-

    sieve_extensions = +spamtest +spamtestplus

    sieve_after = /var/lib/mailrobots/sieve/after

    sieve_quota_max_scripts = 10
    sieve_quota_max_storage = 100KB

    sieve_spamtest_status_type = score
    sieve_spamtest_status_header = X-Spam-Status: \bscore=(-?[[:digit:]]+\.[[:digit:]])\b
    sieve_spamtest_max_header = X-Spam-Status: \brequired=(-?[[:digit:]]+\.[[:digit:]])\b
}

postmaster_address = postmaster@@mailname@

protocol lmtp {
    mail_plugins = $mail_plugins sieve
}

service lmtp {
    unix_listener lmtp {
        mode = 0660
        group = Debian-exim
    }
}

service auth {
    unix_listener auth-smtp {
        mode = 0660
        group = Debian-exim
    }
}

# vim: ft=conf ts=8 sts=4 sw=4 et
